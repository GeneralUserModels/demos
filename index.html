<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Observational Learning</title>
    <link rel="stylesheet" href="static/css/styles.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar" id="progressBar" role="progressbar" aria-label="Upload progress"></div>

    <!-- Header -->
    <header class="header">
        <nav class="nav" role="navigation" aria-label="Main navigation">
            <div class="logo">
                <i class="fas fa-video" aria-hidden="true"></i>
                <span>Observational Learning</span>
            </div>
            <div class="nav-actions">
                <div class="connection-status" id="connectionStatus">
                    <i class="fas fa-circle" aria-hidden="true"></i>
                    <span>Connecting...</span>
                </div>
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode">
                    <i class="fas fa-moon" aria-hidden="true"></i>
                </button>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-content">
                <h1>Observational Learning</h1>
                <p>Advanced AI-powered analysis for user behavior patterns and insights</p>
            </div>
        </section>

        <!-- Navigation Tabs -->
        <section class="tabs-navigation">
            <div class="tabs-container">
                <nav class="tabs-nav" role="tablist">
                    <button class="tab-button active" id="uploadTab" data-tab="upload" role="tab" aria-selected="true" aria-controls="upload-panel">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <span>Upload Video</span>
                    </button>
                    <button class="tab-button" id="analysisTab" data-tab="analysis" role="tab" aria-selected="false" aria-controls="analysis-panel">
                        <i class="fas fa-chart-line"></i>
                        <span>Recent Analysis</span>
                    </button>
                    <button class="tab-button" id="insightsTab" data-tab="insights" role="tab" aria-selected="false" aria-controls="insights-panel">
                        <i class="fas fa-lightbulb"></i>
                        <span>User Behaviour Insights</span>
                    </button>
                    <button class="tab-button" id="queryTab" data-tab="query" role="tab" aria-selected="false" aria-controls="query-panel">
                        <i class="fas fa-search"></i>
                        <span>Query Insights</span>
                    </button>
                </nav>
            </div>
        </section>

        <!-- Tab Panels -->
        <section class="tabs-content">
            <!-- Upload Video Tab -->
            <div class="tab-panel active" id="upload-panel" role="tabpanel" aria-labelledby="uploadTab">
                <div class="panel-card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-cloud-upload-alt"></i>
                            Upload Video for Analysis
                        </h2>
                        <p>Upload your video file to analyze user behavior patterns and extract insights</p>
                    </div>
                    
                    <!-- Video Upload Section -->
                    <!-- Video Upload Section -->
                    <div class="upload-section">
                        <form id="videoForm" class="upload-form">
                            <!-- Video Upload Area -->
                            <div class="upload-zone" id="uploadZone">
                                <input type="file" id="videoFile" accept="video/*" hidden aria-label="Select video file">
                                <div class="upload-zone-content" id="uploadZoneContent">
                                    <div class="upload-icon">
                                        <i class="fas fa-video" aria-hidden="true"></i>
                                    </div>
                                    <h3>Drop your video here</h3>
                                    <p>or click to browse files</p>
                                    <div class="upload-formats">
                                        <span class="format-tag">MP4</span>
                                        <span class="format-tag">AVI</span>
                                        <span class="format-tag">MOV</span>
                                        <span class="format-tag">WMV</span>
                                    </div>
                                </div>
                                <div class="file-preview" id="filePreview" style="display: none;">
                                    <div class="preview-container">
                                        <video id="previewVideo" controls></video>
                                        <div class="file-info">
                                            <h4 id="fileName"></h4>
                                            <div class="file-details">
                                                <span id="fileSize"></span>
                                                <span id="fileDuration"></span>
                                            </div>
                                        </div>
                                        <button type="button" class="remove-file" id="removeFile" aria-label="Remove selected file">
                                            <i class="fas fa-times" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Configuration Panel -->
                            <div class="config-panel">
                                <div class="config-grid">
                                    <div class="config-group">
                                        <label for="videoFps">
                                            <i class="fas fa-clock" aria-hidden="true"></i>
                                            Frame Extraction Rate (FPS)
                                        </label>
                                        <input 
                                            type="number" 
                                            id="videoFps" 
                                            value="0.4" 
                                            step="0.1" 
                                            min="0.1" 
                                            max="2.0"
                                            aria-describedby="fpsHelp"
                                        >
                                        <small id="fpsHelp">Lower values = faster processing, higher values = more detail</small>
                                    </div>

                                    <div class="config-group">
                                        <label for="videoUserName">
                                            <i class="fas fa-user" aria-hidden="true"></i>
                                            User Identifier
                                        </label>
                                        <input 
                                            type="text" 
                                            id="videoUserName" 
                                            placeholder="Optional user identifier"
                                        >
                                        <small>Leave empty to use system default</small>
                                    </div>
                                </div>
                            </div>

                            <!-- Submit Button -->
                            <div class="submit-section">
                                <button type="submit" class="btn-primary" disabled id="uploadBtn">
                                    <i class="fas fa-play" aria-hidden="true"></i>
                                    <span>Start Analysis</span>
                                </button>
                            </div>

                            <!-- Progress Section -->
                            <div class="progress-section" id="progressSection" style="display: none;">
                                <div class="progress-container">
                                    <div class="progress-track">
                                        <div class="progress-fill" id="uploadProgress"></div>
                                    </div>
                                    <div class="progress-info">
                                        <span id="progressText">Initializing analysis...</span>
                                        <span id="progressPercent">0%</span>
                                    </div>
                                </div>
                                <div class="progress-steps">
                                    <div class="step active" id="step1">
                                        <i class="fas fa-upload" aria-hidden="true"></i>
                                        <span>Uploading</span>
                                    </div>
                                    <div class="step" id="step2">
                                        <i class="fas fa-cog" aria-hidden="true"></i>
                                        <span>Processing</span>
                                    </div>
                                    <div class="step" id="step3">
                                        <i class="fas fa-brain" aria-hidden="true"></i>
                                        <span>Analyzing</span>
                                    </div>
                                    <div class="step" id="step4">
                                        <i class="fas fa-check" aria-hidden="true"></i>
                                        <span>Complete</span>
                                    </div>
                                </div>
                            </div>
                        </form>

                        <!-- Results Section -->
                        <div class="results-section" id="resultsSection" style="display: none;">
                            <div class="results-container">
                                <div class="results-header">
                                    <h2>
                                        <i class="fas fa-chart-bar" aria-hidden="true"></i>
                                        Analysis Results
                                    </h2>
                                    <div class="results-actions">
                                        <button class="btn-secondary" id="exportBtn">
                                            <i class="fas fa-download" aria-hidden="true"></i>
                                            Export Results
                                        </button>
                                        <button class="btn-secondary" id="newAnalysisBtn">
                                            <i class="fas fa-plus" aria-hidden="true"></i>
                                            New Analysis
                                        </button>
                                    </div>
                                </div>
                                <div class="results-content" id="resultsContent">
                                    <!-- Results will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Analysis Tab -->
            <div class="tab-panel" id="analysis-panel" role="tabpanel" aria-labelledby="analysisTab">
                <div class="panel-card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-chart-line"></i>
                            Recent Analysis
                        </h2>
                        <p>View recent observations and analysis results from the system</p>
                        <div class="header-actions">
                            <button class="btn-secondary" id="refreshHistory">
                                <i class="fas fa-refresh" aria-hidden="true"></i>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="history-section">
                        <div class="history-content" id="historyContent">
                            <div class="empty-state">
                                <i class="fas fa-chart-line" aria-hidden="true"></i>
                                <h3>No recent analysis</h3>
                                <p>Upload a video or submit observations to see analysis results here</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- User Behaviour Insights Tab -->
            <div class="tab-panel" id="insights-panel" role="tabpanel" aria-labelledby="insightsTab">
                <div class="panel-card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-lightbulb"></i>
                            User Behaviour Insights
                        </h2>
                        <p>Generated insights and propositions about user behavior patterns</p>
                        <div class="header-actions">
                            <div class="filter-group">
                                <label for="confidenceFilter">Min Confidence:</label>
                                <select id="confidenceFilter">
                                    <option value="">All</option>
                                    <option value="5">5+</option>
                                    <option value="7">7+</option>
                                    <option value="8">8+</option>
                                    <option value="9">9+</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="sortBy">Sort by:</label>
                                <select id="sortBy">
                                    <option value="created_at">Most Recent</option>
                                    <option value="confidence">Confidence</option>
                                </select>
                            </div>
                            <button class="btn-secondary" id="loadPropositions">
                                <i class="fas fa-search" aria-hidden="true"></i>
                                Load Insights
                            </button>
                            <button class="btn-danger" id="cleanupDatabase">
                                <i class="fas fa-trash" aria-hidden="true"></i>
                                Clean Database
                            </button>
                        </div>
                    </div>
                    
                    <div class="propositions-stats" id="propositionsStats" style="display: none;">
                        <!-- Stats will be populated here -->
                    </div>
                    
                    <div class="propositions-content" id="propositionsContent">
                        <div class="empty-state">
                            <i class="fas fa-lightbulb" aria-hidden="true"></i>
                            <h3>No insights loaded</h3>
                            <p>Click "Load Insights" to view user behavior propositions</p>
                        </div>
                    </div>
                    
                    <div class="pagination-controls" id="propositionsPagination" style="display: none;">
                        <button class="btn-secondary" id="prevPropositions" disabled>
                            <i class="fas fa-chevron-left" aria-hidden="true"></i>
                            Previous
                        </button>
                        <span id="propositionsPageInfo">Page 1</span>
                        <button class="btn-secondary" id="nextPropositions">
                            Next
                            <i class="fas fa-chevron-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Query Insights Tab -->
            <div class="tab-panel" id="query-panel" role="tabpanel" aria-labelledby="queryTab">
                <div class="panel-card">
                    <div class="card-header">
                        <h2>
                            <i class="fas fa-search"></i>
                            Query Insights
                        </h2>
                        <p>Search and explore insights using natural language queries</p>
                    </div>
                    
                    <div class="query-section">
                        <div class="query-form">
                            <div class="search-container">
                                <div class="search-input-group">
                                    <input 
                                        type="text" 
                                        id="queryInput" 
                                        placeholder="Ask about user behavior patterns, productivity, applications usage..."
                                        class="search-input"
                                        aria-label="Search query"
                                    >
                                    <button type="button" class="search-btn" id="querySearchBtn">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                                <div class="search-options">
                                    <div class="option-group">
                                        <label for="queryLimit">Results:</label>
                                        <select id="queryLimit">
                                            <option value="5">5 results</option>
                                            <option value="10" selected>10 results</option>
                                            <option value="20">20 results</option>
                                            <option value="50">50 results</option>
                                        </select>
                                    </div>
                                    <div class="option-group">
                                        <label for="queryMode">Mode:</label>
                                        <select id="queryMode">
                                            <option value="OR" selected>OR (broader)</option>
                                            <option value="AND">AND (precise)</option>
                                        </select>
                                    </div>
                                    <div class="option-group">
                                        <label for="queryUserName">User:</label>
                                        <input 
                                            type="text" 
                                            id="queryUserName" 
                                            placeholder="Optional user filter"
                                            class="user-input"
                                        >
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="query-examples">
                            <h3>Example Queries:</h3>
                            <div class="examples-grid">
                                <button class="example-query" data-query="productivity patterns">
                                    Productivity patterns
                                </button>
                                <button class="example-query" data-query="application usage">
                                    Application usage
                                </button>
                                <button class="example-query" data-query="time management">
                                    Time management
                                </button>
                                <button class="example-query" data-query="communication habits">
                                    Communication habits
                                </button>
                                <button class="example-query" data-query="workflow efficiency">
                                    Workflow efficiency
                                </button>
                                <button class="example-query" data-query="focus and distraction">
                                    Focus and distraction
                                </button>
                            </div>
                        </div>
                        
                        <div class="query-results-section" id="queryResultsSection">
                            <div class="loading-overlay" id="queryLoading" style="display: none;">
                                <div class="spinner"></div>
                                <span>Searching insights...</span>
                            </div>
                            
                            <div class="query-results" id="queryResults">
                                <div class="empty-state">
                                    <i class="fas fa-search" aria-hidden="true"></i>
                                    <h3>Ready to search</h3>
                                    <p>Enter a query above or try one of the example queries to get started</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Toast Notifications -->
    <div id="toast" class="toast" role="alert" aria-live="polite"></div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <h3>Processing Video Analysis</h3>
            <p>This may take a few minutes depending on video length...</p>
        </div>
    </div>

    <script src="static/js/app.js?v=2"></script>
</body>
</html>
